# Drawing App

一个基于 React 和 Paper.js 的交互式绘图应用程序，用于创建和管理带有连接关系的盒子图表。

## 技术栈

- React - 用户界面框架
- Paper.js - 矢量图形处理库
- IndexedDB - 本地数据存储
- React Split Pane - 分割面板组件
- Monaco Editor - 代码编辑器组件
- React JSON Editor/Viewer - JSON 数据编辑和查看组件

## 主要功能

1. 绘制和管理盒子
   - 创建和删除盒子
   - 调整盒子大小和位置
   - 自定义盒子属性
   - 支持有限（矩形）和无限（圆形）两种库存类型

2. 连接管理
   - 创建盒子之间的连接线
   - 自动计算连接点
   - 箭头指示方向
   - 显示连接名称和传输数量
   - 智能处理无限库存连接：
     - 从无限库存（圆形）到普通库存的连接：源库存不减少，目标库存正常增加
     - 从普通库存到无限库存的连接：源库存正常减少，目标库存不变（已无限）
     - 连接标签自动显示适当的无限符号（∞）

3. 画布操作
   - 画布缩放和平移
   - 坐标轴显示
   - 自动调整画布大小

4. 数据持久化
   - 使用 IndexedDB 保存画布状态
   - 加载已保存的画布数据

## 项目结构

```
src/
├── App.js              # 应用程序主组件
├── papercanvas.js      # 画布核心实现
├── boxUtils.js         # 盒子操作工具
├── canvasUtils.js      # 画布工具函数
├── connectionUtils.js  # 连接线工具
└── dbService.js        # 数据存储服务
```

## 核心模块说明

### 画布模块 (papercanvas.js)
- 实现画布的主要功能
- 处理用户交互
- 管理盒子和连接的创建、更新和删除

### 盒子工具 (boxUtils.js)
- 处理盒子的添加和删除
- 管理盒子的属性和状态

### 画布工具 (canvasUtils.js)
- 提供画布相关的工具函数
- 处理坐标轴绘制
- 管理画布大小和缩放

### 连接工具 (connectionUtils.js)
- 计算连接线的路径
- 创建带箭头的连接线
- 处理连接标签显示

### 数据服务 (dbService.js)
- 使用 IndexedDB 进行数据持久化
- 提供数据的保存和加载功能

## 安装和运行

1. 安装依赖：
```bash
npm install
```

2. 启动开发服务器：
```bash
npm start
```

3. 构建生产版本：
```bash
npm run build
```

## 使用说明

1. 创建盒子：点击画布空白处
   - 选择矩形（有限库存）或圆形（无限库存）
2. 连接盒子：拖动一个盒子到另一个盒子
   - 连接无限库存时，注意流量规则：
     - 从无限库存流出：deductAmount 不适用（显示为 ∞）
     - 流入无限库存：transferAmount 不适用（显示为 ∞）
3. 编辑属性：双击盒子或连接线
4. 删除元素：选中后按 Delete 键
5. 保存画布：自动保存到本地存储
6. 运行模拟：使用模拟控件测试库存流动
   - 无限库存在模拟中保持不变

## 注意事项

- 建议使用现代浏览器以获得最佳体验
- 确保浏览器支持 IndexedDB
- 大量元素可能会影响性能