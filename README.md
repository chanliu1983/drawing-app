# Drawing App

一个基于 React 和 Paper.js 的交互式绘图应用程序，用于创建和管理带有连接关系的盒子图表。

## 技术栈

- React - 用户界面框架
- Paper.js - 矢量图形处理库
- IndexedDB - 本地数据存储
- React Split Pane - 分割面板组件
- Monaco Editor - 代码编辑器组件
- React JSON Editor/Viewer - JSON 数据编辑和查看组件

## 主要功能

1. 绘制和管理盒子
   - 创建和删除盒子
   - 调整盒子大小和位置
   - 自定义盒子属性
   - 支持有限（矩形）和无限（圆形）两种库存类型

2. 连接管理
   - 创建盒子之间的连接线
   - 自动计算连接点
   - 箭头指示方向
   - 显示连接名称和传输数量
   - 智能处理无限库存连接：
     - 从无限库存（圆形）到普通库存的连接：源库存不减少，目标库存正常增加
     - 从普通库存到无限库存的连接：源库存正常减少，目标库存不变（已无限）
     - 连接标签自动显示适当的无限符号（∞）

3. 画布操作
   - 画布缩放和平移
   - 坐标轴显示
   - 自动调整画布大小

4. 数据持久化
   - 使用 IndexedDB 保存画布状态
   - 加载已保存的画布数据

## IDE 调试配置

本项目已配置了完整的 VS Code 调试环境，支持多种调试方式：

### 调试配置说明

1. **Debug React App (Chrome)** - 推荐方式
   - 在 Chrome 浏览器中启动应用并附加调试器
   - 支持断点、变量检查、调用栈等完整调试功能
   - 自动启动开发服务器

2. **Debug React App** - Node.js 调试
   - 直接调试 React 开发服务器进程
   - 适用于调试构建过程和服务器端逻辑

3. **Debug Tests** - 测试调试
   - 调试所有测试文件
   - 支持断点和变量检查

4. **Debug Current Test File** - 单文件测试调试
   - 调试当前打开的测试文件
   - 快速调试特定测试用例

### 如何使用 IDE 调试

#### 方法一：使用调试面板（推荐）
1. 在 VS Code 中打开项目
2. 按 `Cmd+Shift+D` (macOS) 或 `Ctrl+Shift+D` (Windows/Linux) 打开调试面板
3. 选择 "Debug React App (Chrome)" 配置
4. 点击绿色播放按钮或按 `F5` 开始调试
5. 应用会自动在 Chrome 中打开，调试器已附加

#### 方法二：使用命令面板
1. 按 `Cmd+Shift+P` (macOS) 或 `Ctrl+Shift+P` (Windows/Linux)
2. 输入 "Debug: Start Debugging"
3. 选择调试配置

#### 设置断点
1. 在代码行号左侧点击设置断点（红色圆点）
2. 或者在代码中添加 `debugger;` 语句
3. 运行调试配置，程序会在断点处暂停

#### 调试功能
- **变量检查**：在调试面板查看局部变量和全局变量
- **调用栈**：查看函数调用链
- **监视表达式**：添加自定义表达式进行监视
- **控制台**：在调试上下文中执行代码
- **步进调试**：逐行执行代码（F10 步过，F11 步入，Shift+F11 步出）

### 调试技巧

1. **React 组件调试**
   - 在组件的 `useEffect`、事件处理函数中设置断点
   - 使用 React Developer Tools 浏览器扩展配合调试

2. **Paper.js 画布调试**
   - 在 `papercanvas.js` 中的绘图函数设置断点
   - 检查 Paper.js 对象的属性和方法

3. **数据流调试**
   - 在 `dbService.js` 中调试数据库操作
   - 监视状态变化和数据传递

### 环境要求

- VS Code
- Chrome 浏览器（用于浏览器调试）
- Node.js 和 npm

## 项目结构

```
src/
├── App.js              # 应用程序主组件
├── papercanvas.js      # 画布核心实现
├── boxUtils.js         # 盒子操作工具
├── canvasUtils.js      # 画布工具函数
├── connectionUtils.js  # 连接线工具
└── dbService.js        # 数据存储服务

.vscode/
├── launch.json         # 调试配置
├── settings.json       # VS Code 设置
└── tasks.json          # 任务配置
```

## 核心模块说明

### 画布模块 (papercanvas.js)
- 实现画布的主要功能
- 处理用户交互
- 管理盒子和连接的创建、更新和删除

### 盒子工具 (boxUtils.js)
- 处理盒子的添加和删除
- 管理盒子的属性和状态

### 画布工具 (canvasUtils.js)
- 提供画布相关的工具函数
- 处理坐标轴绘制
- 管理画布大小和缩放

### 连接工具 (connectionUtils.js)
- 计算连接线的路径
- 创建带箭头的连接线
- 处理连接标签显示

### 数据服务 (dbService.js)
- 使用 IndexedDB 进行数据持久化
- 提供数据的保存和加载功能

## 安装和运行

1. 安装依赖：
```bash
npm install
```

2. 启动开发服务器：
```bash
npm start
```

3. 构建生产版本：
```bash
npm run build
```

## 使用说明

1. 创建盒子：点击画布空白处
   - 选择矩形（有限库存）或圆形（无限库存）
2. 连接盒子：拖动一个盒子到另一个盒子
   - 连接无限库存时，注意流量规则：
     - 从无限库存流出：deductAmount 不适用（显示为 ∞）
     - 流入无限库存：transferAmount 不适用（显示为 ∞）
3. 编辑属性：双击盒子或连接线
4. 删除元素：选中后按 Delete 键
5. 保存画布：自动保存到本地存储
6. 运行模拟：使用模拟控件测试库存流动
   - 无限库存在模拟中保持不变

## 注意事项

- 建议使用现代浏览器以获得最佳体验
- 确保浏览器支持 IndexedDB
- 大量元素可能会影响性能